<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Buscador de Viajes Mejorado - TuneMyTrip</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background-image:
        url('https://cdn.pixabay.com/photo/2017/01/20/00/30/earth-1990217_1280.jpg'),
        url('https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Air_traffic_routes.svg/1200px-Air_traffic_routes.svg.png');
      background-position: center center, center center;
      background-repeat: no-repeat, no-repeat;
      background-size: cover, contain;
      background-attachment: fixed, fixed;
      background-blend-mode: overlay;
      background-color: rgba(0,0,0,0.5);
      color: #fff;
      min-height: 100vh;
    }
    /* (El resto de estilos permanece igual que antes, por brevedad no los repito aquí) */
    /* ... */
  </style>
</head>
<body>
  <!-- Logo y botones temáticos (igual que antes) -->
  <div class="logo-container" role="banner" aria-label="Logotipo TuneMyTrip">
    <!-- SVG aquí -->
  </div>

  <div class="button-group" role="navigation" aria-label="Categorías de viajes">
    <!-- Botones temáticos aquí -->
  </div>

  <form id="search-form" aria-label="Formulario de búsqueda de viajes">
    <div class="row">
      <div>
        <label for="origin">Origen (ej: MAD)</label>
        <input type="text" id="origin" name="origin" placeholder="Ciudad o código IATA" required />
      </div>
      <div>
        <label for="checkInDate">Fecha de llegada</label>
        <input type="date" id="checkInDate" name="checkInDate" required />
      </div>
    </div>
    <div class="row">
      <div>
        <label for="destination">Destino (ej: NYC)</label>
        <input type="text" id="destination" name="destination" placeholder="Ciudad o código IATA" required />
      </div>
      <div>
        <label for="checkOutDate">Fecha de salida</label>
        <input type="date" id="checkOutDate" name="checkOutDate" required />
      </div>
    </div>

    <div class="checkbox-group">
      <input type="checkbox" id="travelInsurance" name="travelInsurance" />
      <label for="travelInsurance">Contratar seguro de viaje</label>
    </div>

    <button type="submit" class="btn-submit">Buscar viajes</button>
  </form>

  <!-- Modal selección de aeropuerto -->
  <div id="modal-airports" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal-content">
      <button class="modal-close" id="close-modal-airports" aria-label="Cerrar ventana">&times;</button>
      <h3 id="modal-title">Selecciona un destino</h3>
      <ul class="airport-list" id="airport-list"></ul>
    </div>
  </div>

  <!-- Modal cotización seguro -->
  <div id="insurance-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="insurance-modal-title">
    <div class="modal-content">
      <button class="modal-close" id="close-insurance-modal" aria-label="Cerrar ventana">&times;</button>
      <h2 id="insurance-modal-title">Cotiza tu seguro de viaje</h2>
      <form id="insurance-quote-form">
        <label for="insured-name">Nombre completo</label>
        <input type="text" id="insured-name" name="insured-name" required />
        <label for="insured-age">Edad</label>
        <input type="number" id="insured-age" name="insured-age" min="0" max="120" maxlength="3" required />
        <label for="insured-country">País de destino</label>
        <input type="text" id="insured-country" name="insured-country" required />
        <div class="row">
          <div>
            <label for="insured-start-date">Fecha inicio</label>
            <input type="date" id="insured-start-date" name="insured-start-date" required />
          </div>
          <div>
            <label for="insured-end-date">Fecha fin</label>
            <input type="date" id="insured-end-date" name="insured-end-date" required />
          </div>
        </div>
        <button type="submit">Solicitar cotización</button>
      </form>
      <div id="insurance-quote-result"></div>
    </div>
  </div>

  <script>
    // Código para modal aeropuertos (igual que antes)
    const thematicAirports = {
      arquitectura: [
        { name: "Barcelona (BCN) - España", code: "BCN" },
        { name: "Dubái (DXB) - Emiratos Árabes", code: "DXB" },
        { name: "París (CDG) - Francia", code: "CDG" }
      ],
      // ... otros temas ...
    };

    const modal = document.getElementById('modal-airports');
    const airportList = document.getElementById('airport-list');
    const closeModalBtn = document.getElementById('close-modal-airports');
    const destinationInput = document.getElementById('destination');

    document.querySelectorAll('.btn-feature').forEach(btn => {
      btn.addEventListener('click', () => {
        const theme = btn.getAttribute('data-theme');
        const airports = thematicAirports[theme] || [];
        airportList.innerHTML = airports.map(a =>
          `<li><button class="airport-btn" data-code="${a.code}">${a.name}</button></li>`
        ).join('');
        modal.style.display = "flex";
      });
    });

    airportList.addEventListener('click', e => {
      if (e.target.classList.contains('airport-btn')) {
        const code = e.target.getAttribute('data-code');
        destinationInput.value = code;
        modal.style.display = "none";
      }
    });

    closeModalBtn.addEventListener('click', () => {
      modal.style.display = "none";
    });

    window.addEventListener('click', e => {
      if (e.target === modal) {
        modal.style.display = "none";
      }
    });

    // Modal seguro y precarga de fechas y país destino
    const travelInsuranceCheckbox = document.getElementById('travelInsurance');
    const insuranceModal = document.getElementById('insurance-modal');
    const closeInsuranceModalBtn = document.getElementById('close-insurance-modal');

    const checkInDateInput = document.getElementById('checkInDate');
    const checkOutDateInput = document.getElementById('checkOutDate');

    const insuredStartDate = document.getElementById('insured-start-date');
    const insuredEndDate = document.getElementById('insured-end-date');
    const insuredCountry = document.getElementById('insured-country');

    travelInsuranceCheckbox.addEventListener('change', () => {
      if (travelInsuranceCheckbox.checked) {
        // Precargar fechas y país destino
        insuredStartDate.value = checkInDateInput.value;
        insuredEndDate.value = checkOutDateInput.value;
        insuredCountry.value = destinationInput.value.trim();
        insuranceModal.style.display = 'flex';
      } else {
        insuranceModal.style.display = 'none';
      }
    });

    closeInsuranceModalBtn.addEventListener('click', () => {
      insuranceModal.style.display = 'none';
      travelInsuranceCheckbox.checked = false;
    });

    window.addEventListener('click', e => {
      if (e.target === insuranceModal) {
        insuranceModal.style.display = 'none';
        travelInsuranceCheckbox.checked = false;
      }
    });

    // Actualizar fechas y país si cambian y modal está abierto
    checkInDateInput.addEventListener('change', () => {
      if (insuranceModal.style.display === 'flex') {
        insuredStartDate.value = checkInDateInput.value;
      }
    });
    checkOutDateInput.addEventListener('change', () => {
      if (insuranceModal.style.display === 'flex') {
        insuredEndDate.value = checkOutDateInput.value;
      }
    });
    destinationInput.addEventListener('input', () => {
      if (insuranceModal.style.display === 'flex') {
        insuredCountry.value = destinationInput.value.trim();
      }
    });

    // Validación y restricción campo Edad
    const insuredAgeInput = document.getElementById('insured-age');
    insuredAgeInput.addEventListener('input', function() {
      this.value = this.value.replace(/\D/g, '');
      if (this.value.length > 3) {
        this.value = this.value.slice(0, 3);
      }
    });

    // Formulario principal
    document.getElementById('search-form').addEventListener('submit', e => {
      e.preventDefault();
      const form = e.target;
      const data = {
        origin: form.origin.value.trim().toUpperCase(),
        destination: form.destination.value.trim().toUpperCase(),
        checkInDate: form.checkInDate.value,
        checkOutDate: form.checkOutDate.value,
        travelInsurance: form.travelInsurance.checked
      };
      if (data.checkOutDate <= data.checkInDate) {
        alert('La fecha de salida debe ser posterior a la fecha de llegada.');
        return;
      }
      sessionStorage.setItem('searchData', JSON.stringify(data));
      window.location.href = 'resultados.html';
    });

    // Formulario cotización seguro
    document.getElementById('insurance-quote-form').addEventListener('submit', e => {
      e.preventDefault();
      const name = document.getElementById('insured-name').value.trim();
      const ageStr = document.getElementById('insured-age').value.trim();
      const age = parseInt(ageStr, 10);
      const country = document.getElementById('insured-country').value.trim();
      const startDate = document.getElementById('insured-start-date').value;
      const endDate = document.getElementById('insured-end-date').value;

      if (!/^\d{1,3}$/.test(ageStr) || isNaN(age) || age < 0 || age > 120) {
        alert('Por favor, ingresa una edad válida (0-120, máximo 3 dígitos).');
        return;
      }
      if (endDate <= startDate) {
        alert('La fecha de fin debe ser posterior a la fecha de inicio.');
        return;
      }

      let quote = 0;
      if (age < 18) quote = 30;
      else if (age < 40) quote = 50;
      else if (age < 65) quote = 70;
      else quote = 120;

      const resultDiv = document.getElementById('insurance-quote-result');
      resultDiv.innerHTML = `
        <div>
          <strong style="color:#00c6ff;font-size:1.2em;">Cotización para ${name}:</strong><br>
          Destino: ${country}<br>
          Fechas: ${startDate} a ${endDate}<br>
          Edad: ${age} años<br>
          <span style="font-size:1.1em;">Precio estimado: <strong style="color:#000;">$${quote} USD</strong></span>
        </div>
        <div style="margin-top:10px;">
          <button onclick="alert('¡Solicitud enviada! Un asesor te contactará pronto.')" style="background:#00c6ff;color:#003f5c;font-weight:700;padding:10px 22px;border:none;border-radius:7px;cursor:pointer;">Solicitar este seguro</button>
        </div>
      `;
    });
  </script>
</body>
</html>
